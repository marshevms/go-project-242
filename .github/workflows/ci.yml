# Название workflow, отображается в интерфейсе GitHub Actions
name: CI

# Секция on определяет события, при которых запускается workflow
on:
  # Запуск при push (отправке коммитов) в репозиторий
  push:
    branches:
      - main # Запускать при push в ветку main
      - master # Запускать при push в ветку master
  # Запуск при создании или обновлении Pull Request
  pull_request:
    branches:
      - main # Запускать для PR, направленных в main
      - master # Запускать для PR, направленных в master

# Секция jobs содержит задачи, которые будут выполняться
jobs:
  # Имя задачи - build (сборка)
  build:
    # Указываем, на какой виртуальной машине запускать задачу
    # ubuntu-latest - последняя стабильная версия Ubuntu
    runs-on: ubuntu-latest

    # steps - последовательность шагов для выполнения
    steps:
      # Шаг 1: Клонирование репозитория в рабочую директорию runner'а
      # Без этого шага код проекта не будет доступен
      - name: Checkout code
        uses: actions/checkout@v4

      # Шаг 2: Установка Go нужной версии
      # Настраивает окружение для компиляции Go-приложений
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.23" # Версия Go, соответствующая go.mod

      # Шаг 3: Сборка приложения
      # Выполняет команду make build из Makefile
      # Компилирует исходный код в исполняемый файл
      - name: Build
        run: make build

      # Шаг 4: Запуск приложения
      # Проверяет, что собранное приложение запускается без ошибок
      - name: Run application
        run: make run
